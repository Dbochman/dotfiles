#!/bin/bash

export HOME="/Users/dbochman"
export PATH="/opt/homebrew/bin:/usr/local/bin:/usr/bin:/bin"

CACHE="$HOME/.openclaw/.secrets-cache"

# Source secrets from cache file (KEY=VALUE format, one per line).
# Cache is populated/refreshed via: ssh dylans-mac-mini ~/bin/openclaw-refresh-secrets
if [[ -f "$CACHE" ]]; then
  set -a
  source "$CACHE"
  set +a
else
  echo "FATAL: No secrets cache at $CACHE" >&2
  echo "Run: ssh dylans-mac-mini ~/bin/openclaw-refresh-secrets" >&2
  exit 1
fi

# Verify critical secrets loaded
if [[ -z "${OPENCLAW_GATEWAY_TOKEN:-}" ]]; then
  echo "FATAL: OPENCLAW_GATEWAY_TOKEN not found in cache" >&2
  exit 1
fi

exec /opt/homebrew/Cellar/node@22/22.22.0/bin/node /opt/homebrew/lib/node_modules/openclaw/dist/index.js gateway --port 18789
